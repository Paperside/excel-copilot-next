# Excel Copilot - AIé©±åŠ¨çš„Excelåˆ†æåŠ©æ‰‹

ä¸€ä¸ªåŸºäºAIçš„Excelæ•°æ®åˆ†æå’Œå¤„ç†åº”ç”¨,æ”¯æŒè‡ªç„¶è¯­è¨€äº¤äº’ã€Pythonä»£ç æ‰§è¡Œå’ŒExcelæ–‡ä»¶æ“ä½œã€‚

## ğŸ¯ é¡¹ç›®çŠ¶æ€

**å½“å‰ç‰ˆæœ¬**: MVP v0.1.0
**çŠ¶æ€**: å¼€å‘ä¸­ ğŸš§

### å·²å®ŒæˆåŠŸèƒ½
- [x] åŸºç¡€é¡¹ç›®ç»“æ„ (monorepo with pnpm workspace)
- [x] Pythonæ‰§è¡Œç¯å¢ƒ(Jupyter Kernel)
  - [x] KernelManager (ç”¨æˆ·éš”ç¦»ã€è¶…æ—¶ç®¡ç†)
  - [x] CodeExecutor (ä»£ç æ‰§è¡Œã€ç»“æœæ”¶é›†)
  - [x] FastAPI HTTPæœåŠ¡
  - [x] å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–
- [x] æ¨¡æ‹ŸS3æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿ
  - [x] S3é£æ ¼çš„keyç®¡ç†
  - [x] ç”¨æˆ·ç›®å½•éš”ç¦»
  - [x] æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½API
- [x] Expressåç«¯API
  - [x] è®¤è¯è·¯ç”±(æ— å¯†ç ç™»å½•)
  - [x] æ–‡ä»¶ç®¡ç†è·¯ç”±
  - [x] èŠå¤©è·¯ç”±(SSEæµå¼)
- [x] Mastra Agenté›†æˆ
  - [x] Excel Copilot Agent
  - [x] run_pythonå·¥å…·(æ”¯æŒfileIdså‚æ•°)
  - [x] PostgreSQLå­˜å‚¨é›†æˆ
- [x] æ•°æ®åº“Schemaè®¾è®¡
- [x] Next.jså‰ç«¯æ¡†æ¶
  - [x] æ— å¯†ç ç™»å½•ç•Œé¢
  - [x] èŠå¤©ç•Œé¢(SSEæµå¼å“åº”)
  - [x] æ–‡ä»¶ç®¡ç†(ä¸Šä¼ ã€åˆ—è¡¨ã€åˆ é™¤)
  - [x] æ–‡ä»¶é€‰æ‹©å™¨(@æ–‡ä»¶åŠŸèƒ½åŸºç¡€)
  - [x] Tailwind CSS + shadcn/uiç»„ä»¶

### å¾…å®ç°åŠŸèƒ½

- [ ] ä¼šè¯å†å²æŒä¹…åŒ–å’ŒåŠ è½½
- [ ] ä»£ç æ‰§è¡Œå¯è§†åŒ–
- [ ] å›¾è¡¨/å›¾ç‰‡å±•ç¤º
- [ ] é”™è¯¯å¤„ç†ä¼˜åŒ–

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Next.js Frontend                    â”‚
â”‚         (èŠå¤©ç•Œé¢ + æ–‡ä»¶ç®¡ç†)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“ HTTPS/SSE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Express Backend                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Mastra Module                            â”‚  â”‚
â”‚  â”‚  â””â”€ Excel Copilot Agent                  â”‚  â”‚
â”‚  â”‚     â””â”€ run_python Tool                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Mock S3 File Storage                    â”‚  â”‚
â”‚  â”‚  â””â”€ uploads/ + generated/                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“ IPC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Python Executor (ç‹¬ç«‹è¿›ç¨‹)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Jupyter Kernel Manager                  â”‚  â”‚
â”‚  â”‚  â””â”€ User Kernels Pool                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  Libraries: Polars, Pandas, Matplotlib, jieba â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PostgreSQL                          â”‚
â”‚  (ç”¨æˆ·ã€æ–‡ä»¶å…ƒæ•°æ®ã€ä¼šè¯ã€Agentè®°å¿†)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
excel-copilot-next/
â”œâ”€â”€ backend/                    # Expressåç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts           # ä¸»å…¥å£
â”‚   â”‚   â”œâ”€â”€ config/            # é…ç½®
â”‚   â”‚   â”œâ”€â”€ routes/            # APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ fileStorage.ts # æ¨¡æ‹ŸS3å­˜å‚¨
â”‚   â”‚   â”‚   â””â”€â”€ pythonExecutor.ts # Pythonæ‰§è¡Œå™¨å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ mastra/            # Mastraæ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ agent.ts       # Excel Copilot Agent
â”‚   â”‚   â”‚   â””â”€â”€ tools.ts       # run_pythonå·¥å…·
â”‚   â”‚   â”œâ”€â”€ db/                # æ•°æ®åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.ts      # Drizzle Schema
â”‚   â”‚   â”‚   â””â”€â”€ index.ts       # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â””â”€â”€ middleware/        # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ python-executor/           # Pythonæ‰§è¡Œç¯å¢ƒ
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.py           # ä¸»å…¥å£(HTTPæœåŠ¡å™¨)
â”‚   â”‚   â”œâ”€â”€ kernel_manager.py # Kernelç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ code_executor.py  # ä»£ç æ‰§è¡Œå™¨
â”‚   â”‚   â””â”€â”€ models.py         # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ tests/                # å•å…ƒæµ‹è¯•
â”‚   â”‚   â””â”€â”€ test_executor.py
â”‚   â”œâ”€â”€ pyproject.toml        # uvé…ç½®
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ frontend/                  # Next.jså‰ç«¯
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ page.tsx          # ç™»å½•é¡µé¢
â”‚   â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx      # èŠå¤©ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ layout.tsx        # æ ¹å¸ƒå±€
â”‚   â”‚   â””â”€â”€ globals.css       # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/               # shadcn/uiç»„ä»¶
â”‚   â”‚   â””â”€â”€ file-manager.tsx  # æ–‡ä»¶ç®¡ç†ç»„ä»¶
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ api-client.ts     # APIå®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ utils.ts          # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ use-toast.ts      # Toasté’©å­
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ shared/                    # å…±äº«ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ types.ts
â”‚
â”œâ”€â”€ .env.example
â”œâ”€â”€ package.json              # æ ¹package.json
â”œâ”€â”€ pnpm-workspace.yaml       # pnpm workspaceé…ç½®
â””â”€â”€ README.md                 # æœ¬æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 20.0.0
- Python >= 3.11
- PostgreSQL >= 14
- pnpm >= 8.0.0
- uv (PythonåŒ…ç®¡ç†å™¨)

### å®‰è£…ä¾èµ–

```bash
# 1. å®‰è£…uv (PythonåŒ…ç®¡ç†å™¨)
curl -LsSf https://astral.sh/uv/install.sh | sh

# 2. å®‰è£…é¡¹ç›®ä¾èµ–
pnpm install

# 3. å®‰è£…Pythonä¾èµ–
cd python-executor
uv sync
cd ..
```

### é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘.envæ–‡ä»¶,å¡«å…¥å¿…è¦çš„é…ç½®
# - DATABASE_URL: PostgreSQLè¿æ¥å­—ç¬¦ä¸²
# - OPENAI_API_KEY: OpenAI APIå¯†é’¥
# - JWT_SECRET: JWTç­¾åå¯†é’¥
```

### æ•°æ®åº“è¿ç§»

```bash
cd backend
pnpm db:generate  # ç”Ÿæˆè¿ç§»æ–‡ä»¶
pnpm db:migrate   # æ‰§è¡Œè¿ç§»
```

### å¯åŠ¨å¼€å‘ç¯å¢ƒ

```bash
# ç»ˆç«¯1: å¯åŠ¨Pythonæ‰§è¡Œå™¨
cd python-executor
uv run python src/main.py

# ç»ˆç«¯2: å¯åŠ¨åç«¯
cd backend
pnpm dev

# ç»ˆç«¯3: å¯åŠ¨å‰ç«¯
cd frontend
pnpm dev
```

è®¿é—® http://localhost:3000

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½è¯´æ˜

### 1. æ¨¡æ‹ŸS3æ–‡ä»¶å­˜å‚¨

æ–‡ä»¶å­˜å‚¨åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ,ä½†æ¥å£è®¾è®¡éµå¾ªS3è§„èŒƒ:

```typescript
// æ–‡ä»¶å­˜å‚¨ç»“æ„
storage/
â”œâ”€â”€ uploads/           # ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶
â”‚   â””â”€â”€ {timestamp}-{uuid}.xlsx
â””â”€â”€ generated/         # Agentç”Ÿæˆçš„æ–‡ä»¶
    â””â”€â”€ {timestamp}-{uuid}.xlsx

// æ•°æ®åº“å­˜å‚¨
{
  id: "uuid",
  s3Key: "uploads/1234567890-abc.xlsx",  // æ¨¡æ‹ŸS3 key
  originalName: "é”€å”®æ•°æ®.xlsx",
  owner: "user123",
  source: "upload" | "generated",
  createdAt: "2024-01-01T00:00:00Z"
}
```

### 2. Pythonæ‰§è¡Œç¯å¢ƒ

æ¯ä¸ªç”¨æˆ·æœ‰ç‹¬ç«‹çš„Jupyter Kernel,æ”¯æŒ:
- æŒä¹…åŒ–ä¼šè¯(30åˆ†é’Ÿè¶…æ—¶)
- é¢„åŠ è½½å¸¸ç”¨åº“(Polars, Pandas, Matplotlib, jieba)
- ä»£ç æ‰§è¡Œç»“æœè¿”å›(è¾“å‡ºã€é”™è¯¯ã€å›¾ç‰‡)

### 3. Agentå·¥å…·è°ƒç”¨

Agentå¯ä»¥é€šè¿‡`run_python`å·¥å…·æ‰§è¡ŒPythonä»£ç :

```typescript
// Agentè°ƒç”¨ç¤ºä¾‹
{
  tool: "run_python",
  parameters: {
    code: "import polars as pl\ndf = pl.read_excel('file.xlsx')\nprint(df.head())",
    fileIds: ["file-uuid-1", "file-uuid-2"],  // Agentå‘ŠçŸ¥éœ€è¦çš„æ–‡ä»¶
    userId: "user123"
  }
}
```

åç«¯ä¼š:
1. æ ¹æ®`fileIds`ä»æ¨¡æ‹ŸS3ä¸‹è½½æ–‡ä»¶åˆ°ç”¨æˆ·ç›®å½•
2. åœ¨ç”¨æˆ·çš„Kernelä¸­æ‰§è¡Œä»£ç 
3. è¿”å›æ‰§è¡Œç»“æœ

## ğŸ§ª æµ‹è¯•

### Pythonæ‰§è¡Œå™¨æµ‹è¯•

```bash
cd python-executor
uv run pytest tests/ -v
```

### åç«¯æµ‹è¯• (TODO)

```bash
cd backend
pnpm test
```

## ğŸ“ å¼€å‘ç¬”è®°

### 2024-01-XX - é¡¹ç›®åˆå§‹åŒ–

- ç¡®å®šæŠ€æœ¯æ ˆ: Express + Mastra + Next.js + Python(uv)
- è®¾è®¡æ¨¡æ‹ŸS3æ–‡ä»¶å­˜å‚¨æ–¹æ¡ˆ
- å®ç°Pythonæ‰§è¡Œç¯å¢ƒåŸºç¡€æ¶æ„

### è®¾è®¡å†³ç­–

1. **ä¸ºä»€ä¹ˆä½¿ç”¨Expressè€Œä¸æ˜¯çº¯Mastra?**
   - æ›´çµæ´»çš„è·¯ç”±å’Œä¸­é—´ä»¶æ”¯æŒ
   - æ›´å®¹æ˜“é›†æˆç¬¬ä¸‰æ–¹åº“
   - Mastraä½œä¸ºæ¨¡å—æ›´æ¸…æ™°

2. **ä¸ºä»€ä¹ˆä½¿ç”¨æ¨¡æ‹ŸS3?**
   - æœ¬åœ°å¼€å‘ç®€å•
   - æ¥å£è®¾è®¡å¯æ‰©å±•,æœªæ¥è¿ç§»åˆ°çœŸå®S3æ— ç—›
   - æ•°æ®åº“å­˜å‚¨s3Keyè€Œéæœ¬åœ°è·¯å¾„

3. **ä¸ºä»€ä¹ˆè®©Agentä¼ é€’fileIds?**
   - Agentæ˜ç¡®çŸ¥é“å®ƒéœ€è¦å“ªäº›æ–‡ä»¶
   - é¿å…æ— è°“çš„æ–‡ä»¶ä¼ è¾“
   - æ›´å¥½çš„é”™è¯¯å¤„ç†(æ–‡ä»¶ä¸å­˜åœ¨æ—¶æå‰æŠ¥é”™)

## ğŸ”® åç»­è®¡åˆ’

### v0.2.0 - åŸºç¡€åŠŸèƒ½å®Œå–„
- [ ] å®Œæ•´çš„é”™è¯¯å¤„ç†
- [ ] ä¼šè¯å†å²åŠ è½½
- [ ] @æ–‡ä»¶åŠŸèƒ½
- [ ] æ–‡ä»¶é¢„è§ˆ

### v0.3.0 - ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] ä»£ç æ‰§è¡Œå¯è§†åŒ–
- [ ] å›¾è¡¨å±•ç¤ºä¼˜åŒ–
- [ ] æ‰¹é‡æ–‡ä»¶æ“ä½œ

### v1.0.0 - ç”Ÿäº§å°±ç»ª
- [ ] è¿ç§»åˆ°çœŸå®S3
- [ ] Redisç¼“å­˜
- [ ] ç›‘æ§å’Œæ—¥å¿—
- [ ] æ€§èƒ½ä¼˜åŒ–

## ğŸ“„ License

MIT

## ğŸ¤ è´¡çŒ®

æš‚ä¸æ¥å—å¤–éƒ¨è´¡çŒ®,é¡¹ç›®å¤„äºæ—©æœŸå¼€å‘é˜¶æ®µã€‚
